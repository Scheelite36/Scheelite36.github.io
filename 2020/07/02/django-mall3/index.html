<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Django2.2实战积分商城3——后台管理的使用 | 一只柑の博客</title><meta name="keywords" content="Python,Django,实战,JavaScript,JQuery,AJAX"><meta name="author" content="一只柑"><meta name="copyright" content="一只柑"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="该文章是慕课网相关课程的笔记 上一篇文章已经以该积分商城为例，配置了积分商城的后台管理系统，我们继续补充与完善积分商城的功能 商品用户等管理配置添加各个模块的模型管理配置 略 商品富文本的使用安装配置富文本编辑器 1pip install django-ckeditor  settings.py 123456789INSATLLED_APPS &#x3D; [    ...    # 富文本编辑器    &amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="Django2.2实战积分商城3——后台管理的使用">
<meta property="og:url" content="http://123.57.158.5/2020/07/02/django-mall3/index.html">
<meta property="og:site_name" content="一只柑の博客">
<meta property="og:description" content="该文章是慕课网相关课程的笔记 上一篇文章已经以该积分商城为例，配置了积分商城的后台管理系统，我们继续补充与完善积分商城的功能 商品用户等管理配置添加各个模块的模型管理配置 略 商品富文本的使用安装配置富文本编辑器 1pip install django-ckeditor  settings.py 123456789INSATLLED_APPS &#x3D; [    ...    # 富文本编辑器    &amp;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://cdn.rice-and-bran.site/Django_cover1.jpg">
<meta property="article:published_time" content="2020-07-02T02:02:00.000Z">
<meta property="article:modified_time" content="2021-05-23T02:34:36.750Z">
<meta property="article:author" content="一只柑">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Django">
<meta property="article:tag" content="实战">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="JQuery">
<meta property="article:tag" content="AJAX">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://cdn.rice-and-bran.site/Django_cover1.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://123.57.158.5/2020/07/02/django-mall3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: '',
  enable_page_level_ads: 'true'
});</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Django2.2实战积分商城3——后台管理的使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-05-23 10:34:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="一只柑の博客" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">77</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">63</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('http://cdn.rice-and-bran.site/Django_cover1.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">一只柑の博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Django2.2实战积分商城3——后台管理的使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-07-02T02:02:00.000Z" title="发表于 2020-07-02 10:02:00">2020-07-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-23T02:34:36.750Z" title="更新于 2021-05-23 10:34:36">2021-05-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/">实战案例</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>该文章是<a target="_blank" rel="noopener" href="https://www.imooc.com/">慕课网</a>相关课程的笔记</p>
<p>上一篇文章已经以该积分商城为例，配置了积分商城的后台管理系统，我们继续补充与完善积分商城的功能</p>
<h2 id="商品用户等管理配置"><a href="#商品用户等管理配置" class="headerlink" title="商品用户等管理配置"></a>商品用户等管理配置</h2><p>添加各个模块的模型管理配置</p>
<p>略</p>
<h2 id="商品富文本的使用"><a href="#商品富文本的使用" class="headerlink" title="商品富文本的使用"></a>商品富文本的使用</h2><p>安装配置富文本编辑器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-ckeditor</span><br></pre></td></tr></table></figure>

<p>settings.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSATLLED_APPS = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 富文本编辑器</span></span><br><span class="line">    <span class="string">&#x27;ckeditor&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ckeditor_uploader&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义富文本编辑器上传的路径</span></span><br><span class="line">CKEDITOR_UPLOAD_PATH = os.path.join(MEDIA_ROOT, <span class="string">&#x27;uploads&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>商品的 models.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ckeditor.fields <span class="keyword">import</span> RichTextField</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 商品信息 &quot;&quot;&quot;</span></span><br><span class="line">    ...</span><br><span class="line">    content = RichTextField(<span class="string">&#x27;商品描述&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/02/django-mall3/image-20200703114959036.png" alt="image-20200703114959036"></p>
<p>此时后端管理的商品信息表中就会自动生成html富文本编辑器，方便商品信息页的修改和后台显示。</p>
<p><img src="/2020/07/02/django-mall3/image-20200702103152611.png" alt="image-20200702103152611"></p>
<p>可以在pycharm侧边栏的 External Libraries查看包的源码和相关用法，也可以在pypi上查找ckeditor的文档。</p>
<h2 id="商品前台展示"><a href="#商品前台展示" class="headerlink" title="商品前台展示"></a>商品前台展示</h2><p>给商品详情页添加视图和url，用商品uid放在get参数中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re_path(<span class="string">r&#x27;^pro/detail/(?P&lt;pk&gt;\S+)/$&#x27;</span>,views.pro_info,name=<span class="string">&#x27;pro_info&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>views.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pro_info</span>(<span class="params">request, pk</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 商品详情 &quot;&quot;&quot;</span></span><br><span class="line">    pro_obj = get_object_or_404(Product, uid=pk, is_valid=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;pro_info.html&#x27;</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;pro_obj&#x27;</span>:pro_obj,</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>完善商品详情页的HTML代码。导入模板</p>
<p><font size="2.5">先修改页面为继承，缩减代码。通过模板导入商品详情页的商品信息、图片url等。例如详情页的商品展示图，可通过后台管理上传图片，再导入到模板中。</font></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for banner in pro_obj.banners.all %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-slide&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; banner.img.url &#125;&#125;&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><font size="2.5">对于商品详情页我们填入的html代码，通过模板过滤器将它显示出来</font></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pro-detail&quot;</span>&gt;</span></span><br><span class="line">&#123;&#123; pro_obj.content|safe &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在商品列表中加入商品详情页的跳转</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% url &#x27;mall:pro_info&#x27; item.uid %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/02/django-mall3/image-20200705150917129.png" alt="image-20200705150917129"></p>
<p><img src="/2020/07/02/django-mall3/image-20200705150944816.png" alt="image-20200705150944816"></p>
<h2 id="商品标签"><a href="#商品标签" class="headerlink" title="商品标签"></a>商品标签</h2><p>现在我们要给首页的精选推荐等绑定商品。</p>
<p>首先通过后台添加商品标签，并给相关商品绑定标签</p>
<p><img src="/2020/07/02/django-mall3/image-20200705151635701.png" alt="image-20200705151635701"></p>
<p>现在需要实现在首页的html中，实现精选推荐、酒水推荐等栏目的链接和跳转。</p>
<p>THML中设置url跳转，同时添加tag筛选参数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% url &#x27;mall:product_list&#x27; %&#125;?tag=jxtj</span><br></pre></td></tr></table></figure>

<p>同时给跳转目标的视图函数中（这里是商品分页的视图）,给其中的分页器定义按标签进行搜索的方法。</p>
<p>为了能使有相关标签的商品能显示，还需要将标签tag参数传入显示商品列表的html页面的ajax函数中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductList</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 使用面向对象的方法实现商品的展示 &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 每页放多少条数据</span></span><br><span class="line">    paginate_by = <span class="number">6</span></span><br><span class="line">    <span class="comment"># 模板位置</span></span><br><span class="line">    template_name = <span class="string">&#x27;pro_list.html&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        query = Q(status=constants.PRODUCT_STATUS_SELL, is_valid=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 按名称搜索</span></span><br><span class="line">        name = self.request.GET.get(<span class="string">&#x27;search&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> name:</span><br><span class="line">            query = query &amp; Q(name__icontains=name)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 根据tag标签展示商品</span></span><br><span class="line">        tag = self.request.GET.get(<span class="string">&#x27;tag&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> tag:</span><br><span class="line">            <span class="comment"># 进行tags的外键关联查询</span></span><br><span class="line">            query = query &amp; Q(tags__code=tag)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Product.objects.<span class="built_in">filter</span>(query)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_context_data</span>(<span class="params">self, **kwargs</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; 添加额外的参数 如搜索参数 标签参数 在这里用于传递到页面的js中使用&quot;&quot;&quot;</span></span><br><span class="line">        context = <span class="built_in">super</span>().get_context_data(**kwargs)</span><br><span class="line">        context[<span class="string">&#x27;params&#x27;</span>] = self.request.GET.<span class="built_in">dict</span>()</span><br><span class="line">        <span class="keyword">return</span> context</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;&#123;% url &#x27;</span>mall:product_load_list<span class="string">&#x27; %&#125;&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">page</span>: page,</span><br><span class="line">    <span class="attr">search</span>:<span class="string">&#x27;&#123;&#123; params.search|default_if_none:&quot;&quot; &#125;&#125;&#x27;</span>,</span><br><span class="line">    <span class="attr">tag</span>:<span class="string">&#x27;&#123;&#123; params.tag|default_if_none:&quot;&quot; &#125;&#125;&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/02/django-mall3/image-20200705172454783.png" alt="image-20200705172454783"></p>
<p>这样就实现了首页精选推荐和酒水专场的入口。接下来还要实现，下方的商品展示</p>
<p>首先需要修改首页HTML代码和视图，将二者的商品列表传入模板。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 精选推荐的首页显示，其他栏目同理</span></span><br><span class="line">jxtj_list = Product.objects.<span class="built_in">filter</span>(is_valid=<span class="literal">True</span>,</span><br><span class="line">                                   status=constants.PRODUCT_STATUS_SELL,tags__code=<span class="string">&#x27;jxtj&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for item in jstj_list %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;swiper-slide&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;mall:pro_info&#x27; item.uid %&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; item.img.url &#125;&#125;&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/02/django-mall3/image-20200705180007049.png" alt="image-20200705180007049"></p>
<h2 id="商品详情及购买"><a href="#商品详情及购买" class="headerlink" title="商品详情及购买"></a>商品详情及购买</h2><p>上文配置完了推荐入口与下方的推荐商品。其实配置的是相同内容，而实际上，入口处是需要根据商品分类来进行配置查询</p>
<p>我们继续进行优化，将首页上方入口的查询改为通过商品分类进行查询。步骤同上文类似，修改html页面参数，商品列表视图及商品列表页的ajax函数。</p>
<p>在商品详情视图优化识别登录用户，然后传入用户的地址，在详情页显示用户默认地址</p>
<p>（考虑到有些用户没有填默认地址）在用户模型中添加方法，调用默认地址的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">AbstractUser</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 用户基本信息表 &quot;&quot;&quot;</span></span><br><span class="line">    avatar = models.ImageField(upload_to=<span class="string">&#x27;avatar&#x27;</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    integral = models.SmallIntegerField(<span class="string">&#x27;用户积分&#x27;</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    nickname = models.CharField(max_length=<span class="number">32</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    level = models.SmallIntegerField(<span class="string">&#x27;用户等级&#x27;</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    is_valid = models.BooleanField(<span class="string">&#x27;有效性&#x27;</span>,default=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">&#x27;accounts_user&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;用户基本信息&#x27;</span></span><br><span class="line">        verbose_name_plural = <span class="string">&#x27;用户基本信息&#x27;</span></span><br><span class="line">	</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">default_address</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; 用户默认地址调用 &quot;&quot;&quot;</span></span><br><span class="line">        addr = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># 寻址有效地址</span></span><br><span class="line">        <span class="comment"># 通过地址表的related_name调用，相当于UserAddress.objects.filter(xxx)</span></span><br><span class="line">        addr_list = self.user_address.<span class="built_in">filter</span>(is_valid=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 查看是否存在默认地址</span></span><br><span class="line">            addr = addr_list.<span class="built_in">filter</span>(is_default=<span class="literal">True</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 没有默认地址，返回第一个地址</span></span><br><span class="line">                addr = addr_list[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                <span class="comment"># 没有地址</span></span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> addr</span><br></pre></td></tr></table></figure>

<p>在商品详情视图中调用该方法，获取地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pro_info</span>(<span class="params">request, pk</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 商品详情 &quot;&quot;&quot;</span></span><br><span class="line">    pro_obj = get_object_or_404(Product, uid=pk, is_valid=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># 如果用户登录了，则显示默认地址</span></span><br><span class="line">    <span class="keyword">if</span> request.user.is_authenticated:</span><br><span class="line">        <span class="comment"># 调用默认地址，实际上相当于调用了地址表中一个对象</span></span><br><span class="line">        default_address = request.user.default_address</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;pro_info.html&#x27;</span>, &#123;</span><br><span class="line">        <span class="string">&#x27;pro_obj&#x27;</span>:pro_obj,</span><br><span class="line">        <span class="string">&#x27;default_address&#x27;</span>:default_address</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>另：property装饰器是为了实现调用属性一样调用方法</p>
<p>商品详情HTML中导入用户地址</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;promotion-message clear&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;promotion-item-text&quot;</span>&gt;</span>&#123;&#123; default_address.get_address_format &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;promotion-item-text&quot;</span>&gt;</span>&#123;&#123; default_address.address &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/02/django-mall3/image-20200706191249866.png" alt="image-20200706191249866"></p>
<p>成功调用默认地址</p>
<h2 id="订单详情页面"><a href="#订单详情页面" class="headerlink" title="订单详情页面"></a>订单详情页面</h2><p>在mine模块添加订单页视图，通过面向对象的方式实现商品列表。</p>
<p>该订单详情视图继承于DetailView，和ListView一样，也是基于类的视图。DetailView作用是展示对象的详情页面。</p>
<blockquote>
<p>除了从数据库中获取模型列表的数据外，从数据库获取模型的一条记录数据也是常见的需求。比如查看某篇文章的详情，就是从数据库中获取这篇文章的记录然后渲染模板。对于这种类型的需求，Django 提供了一个 DetailView 类视图。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> DetailView</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderDetailView</span>(<span class="params">DetailView</span>):</span></span><br><span class="line">   	<span class="string">&quot;&quot;&quot; 订单详情 &quot;&quot;&quot;</span></span><br><span class="line">	model = Order</span><br><span class="line">    <span class="comment"># slug对应url最后的参数，将模型中的sn字段传入url参数进行查询</span></span><br><span class="line">    slug_field = <span class="string">&#x27;sn&#x27;</span></span><br><span class="line">    slug_url_kwarg = <span class="string">&#x27;sn&#x27;</span></span><br><span class="line">    template_name = <span class="string">&#x27;order_info.html&#x27;</span></span><br></pre></td></tr></table></figure>

<p>mine模块的urls.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path</span><br><span class="line"><span class="keyword">from</span> mine.views <span class="keyword">import</span> OrderDetailView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 订单页面</span></span><br><span class="line">    re_path(<span class="string">r&#x27;^order/(?P&lt;sn&gt;\d+)/$&#x27;</span>, login_required(OrderDetailView.as_view()), name=<span class="string">&#x27;order&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>html页面修改模板继承，detailview默认传递了一个Order模型的对象，叫object。可以通过<code>object.xx</code>调用订单的数据</p>
<p>同时在订单模型中添加一个关联购物车商品的方法，用于调用购物车中的商品数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    xxx</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cart</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; 获取购物车数据 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.cart.exclude(status=constants.ORDER_STATUS_INIT)</span><br></pre></td></tr></table></figure>

<p>HTML中添加模板元素 ，修改地址跳转。同时将支付处修改为提交表单按钮</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;accounts:address_list&#x27; %&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell_access&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;address-name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; object.to_user &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; object.to_phone &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;address-txt&quot;</span>&gt;</span>&#123;&#123; object.to_area &#125;&#125;&#123;&#123; object.to_address &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">...</span><br><span class="line">&#123;% for item in object.get_cart %&#125;</span><br><span class="line"><span class="comment">&lt;!--with 方法用于改写变量 endwith结束--&gt;</span></span><br><span class="line">&#123;% with product=item.product %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box_appmsg ord-pro-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__hd&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../../mall/templates/pro_info.html&quot;</span></span></span><br><span class="line"><span class="tag">           &gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__thumb&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; product.img.url &#125;&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">                 /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__bd&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__desc&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;mall:pro_info&#x27; product.uid %&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ord-pro-link&quot;</span></span></span><br><span class="line"><span class="tag">               &gt;</span>&#123;&#123; product.name &#125;&#125;&lt;/a</span><br><span class="line">                &gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__desc&quot;</span>&gt;</span></span><br><span class="line">            规格：<span class="tag">&lt;<span class="name">span</span>&gt;</span>红色<span class="tag">&lt;/<span class="name">span</span>&gt;</span>，<span class="tag">&lt;<span class="name">span</span>&gt;</span>23<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;clear mg-t-10&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wy-pro-pri fl&quot;</span>&gt;</span></span><br><span class="line">                ¥<span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;num font-15&quot;</span>&gt;</span>&#123;&#123; product.price &#125;&#125;<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pro-amount fr&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;font-13&quot;</span>&gt;</span>数量×<span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>&#123;&#123; item.count &#125;&#125;<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endwith %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2020/07/02/django-mall3/image-20200707220959541.png" alt="image-20200707220959541"></p>
<h2 id="添加到购物车"><a href="#添加到购物车" class="headerlink" title="添加到购物车"></a>添加到购物车</h2><p>商品模型添加 减库存的函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    xxx</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update_storage</span>(<span class="params">self,count</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; 减库存 &quot;&quot;&quot;</span></span><br><span class="line">        self.remain_count = F(<span class="string">&#x27;remain_count&#x27;</span>) - <span class="built_in">abs</span>(count)</span><br><span class="line">        self.save()</span><br><span class="line">        self.refresh_from_db()</span><br></pre></td></tr></table></figure>

<p>给视图中添加加入购物车方法，然后通过js调用该方法。因为涉及到多个模型的调用，需要加入事务机制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="meta">@transaction.atomic</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cart_add</span>(<span class="params">request, pro_uid</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 添加商品到购物车 写接口&quot;&quot;&quot;</span></span><br><span class="line">    user = request.user</span><br><span class="line">    product = get_object_or_404(Product,uid=pro_uid,is_valid=<span class="literal">True</span>,</span><br><span class="line">                                status=constants.PRODUCT_STATUS_SELL)</span><br><span class="line">    <span class="comment"># 购买数量</span></span><br><span class="line">    count = <span class="built_in">int</span>(request.GET.get(<span class="string">&#x27;count&#x27;</span>,<span class="number">1</span>))</span><br><span class="line">    <span class="comment"># 校验库存</span></span><br><span class="line">    <span class="keyword">if</span> product.remain_count &lt; count:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;no&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 减库存</span></span><br><span class="line">    product.update_storage(count)</span><br><span class="line">    <span class="comment"># 生成购物记录</span></span><br><span class="line">    <span class="comment"># 如果已经添加到购物车了，就把购买的数量和价格更新一下</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cart = Cart.objects.get(product=product,user=user,status=constants.ORDER_STATUS_INIT)</span><br><span class="line">        <span class="comment"># 更新价格和数量</span></span><br><span class="line">        count = cart.count+count</span><br><span class="line">        cart.count = count</span><br><span class="line">        cart.amount = count * cart.price</span><br><span class="line">        <span class="comment"># 保存到购物车数据表中</span></span><br><span class="line">        cart.save()</span><br><span class="line">    <span class="keyword">except</span> Cart.DoesNotExist:</span><br><span class="line">        <span class="comment"># 没有加入到过购物车</span></span><br><span class="line">        Cart.objects.create(product=product,user=user,name=product.name,img=product.img,</span><br><span class="line">                            price=product.price,origin_price=product.origin_price,</span><br><span class="line">                            count=count,amount=count * product.price)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>给 加入购物车 的标签添加id属性，加入点击事件调用加入购物车的动作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#cart_add&#x27;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $.post(<span class="string">&#x27;&#123;% url &quot;mine:cart_add&quot; pro_obj.uid %&#125;&#x27;</span>,&#123;</span><br><span class="line">    	<span class="attr">count</span>:<span class="number">1</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>碰到的问题：django.urls.exceptions.NoReverseMatch</p>
<p><img src="/2020/07/02/django-mall3/image-20200708211808882.png" alt="image-20200708211808882"></p>
<p>正则匹配错误，我将url路径商品参数匹配为了数字，实际上应该使用S+</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re_path(<span class="string">r&#x27;^cart/(?P&lt;pro_uid&gt;\S+)/$&#x27;</span>, views.cart_add, name=<span class="string">&#x27;cart_add&#x27;</span>),</span><br></pre></td></tr></table></figure>

<p>这样就可以通过商品详情页直接添加到购物车中</p>
<h2 id="提交订单"><a href="#提交订单" class="headerlink" title="提交订单"></a>提交订单</h2><p>添加购物车url，在商品详情页面、首页页脚中添加跳转。</p>
<p>添加购物车视图，提取用户地址快照保存到订单中，同时修改购物车的状态，关联订单。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> messages</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Sum</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mine.models <span class="keyword">import</span> Order, Cart</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> constants</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cart</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 查询购物车中的商品</span></span><br><span class="line">    product_list = request.user.carts.<span class="built_in">filter</span>(status=constants.ORDER_STATUS_INIT)</span><br><span class="line">    <span class="comment"># 通过聚合函数查询商品总额 然后传入模板</span></span><br><span class="line">    total = product_list.aggregate(Sum(<span class="string">&#x27;amount&#x27;</span>),<span class="built_in">sum</span>(<span class="string">&#x27;count&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> request.method ==<span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># 提取当前用户地址</span></span><br><span class="line">        default_address = request.user.default_address</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> default_address:</span><br><span class="line">            <span class="comment">#消息通知</span></span><br><span class="line">            messages.warning(request,<span class="string">&#x27;请选择地址信息&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;accounts:address_list&#x27;</span>)</span><br><span class="line">        order = Order.objects.create(</span><br><span class="line">            user=request.user,</span><br><span class="line">            <span class="comment"># 生成年月日加上随机数的订单编号</span></span><br><span class="line">            sn=datetime.now().strftime(<span class="string">&#x27;%Y%m%d%H%M%S%f&#x27;</span>)+<span class="built_in">str</span>(random.randint(<span class="number">1000</span>,<span class="number">9999</span>)),</span><br><span class="line">            buy_amount=total[<span class="string">&#x27;amount__sum&#x27;</span>],</span><br><span class="line">            buy_count=total[<span class="string">&#x27;count__sum&#x27;</span>],</span><br><span class="line">            to_user=default_address.receiver,</span><br><span class="line">            to_area=default_address.get_address_format(),</span><br><span class="line">            to_address=default_address.address,</span><br><span class="line">            to_phone=default_address.phone,</span><br><span class="line">        )</span><br><span class="line">        <span class="comment"># 修改购物车中的状态 改为已提交</span></span><br><span class="line">        <span class="comment"># 将生成的订单关联到购物车</span></span><br><span class="line">        product_list.update(status=constants.ORDER_STATUS_SUBMIT,order=order)</span><br><span class="line">        <span class="comment"># 跳转到订单页</span></span><br><span class="line">        messages.success(request,<span class="string">&#x27;下单成功，请支付&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;mine:order&#x27;</span>,order.sn)</span><br><span class="line">    <span class="comment"># 通过聚合函数查询商品总额 然后传入模板</span></span><br><span class="line">    amount = product_list.aggregate(Sum(<span class="string">&#x27;amount&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;shopcart.html&#x27;</span>,&#123;</span><br><span class="line">        <span class="string">&#x27;product_list&#x27;</span>:product_list,</span><br><span class="line">        <span class="string">&#x27;amount&#x27;</span>:total[<span class="string">&#x27;amount__sum&#x27;</span>]</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>对于购物车显示的总额，需要通过聚合函数查询所有商品的总额 ，然后传入购物车模板。其他参数也要响应传入模板</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pro-amount fr&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;Spinner&quot;</span> <span class="attr">data-value</span>=<span class="string">&quot;&#123;&#123; item.count &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;/static/js/jquery.Spinner.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml">  $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    $(<span class="string">&#x27;.Spinner&#x27;</span>).Spinner(&#123; <span class="attr">value</span>: $(<span class="string">&#x27;.Spinner&#x27;</span>).attr(<span class="string">&#x27;data-value&#x27;</span>), <span class="attr">len</span>: <span class="number">3</span>, <span class="attr">max</span>: <span class="number">999</span> &#125;);</span></span></span><br><span class="line"><span class="javascript"><span class="xml">  &#125;);</span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>以上是实现调用数据库中的购买数量，传入模板</p>
<p><img src="/2020/07/02/django-mall3/image-20200709223835870.png" alt="image-20200709223835870"></p>
<p>但是还没有实现底部合计和上面数量的联动，以及购物车添加数量之后导入订单的问题。待后续有时间可以完善。</p>
<p>至此，已经可以实现商品到购物车再到下单页面的流程。</p>
<h2 id="订单支付"><a href="#订单支付" class="headerlink" title="订单支付"></a>订单支付</h2><p>购物车视图中已添加消息通知，将消息通知传入模板。</p>
<p>使用的jQuery weui里的消息toptip消息通知模板，将其加入模板中，或者可以加入公用模板base.html中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> messages %&#125;</span><br><span class="line">&#123;% <span class="keyword">for</span> msg <span class="keyword">in</span> messges %&#125;</span><br><span class="line">$.toptip(<span class="string">&#x27;&#123;&#123; msg &#125;&#125;&#x27;</span>,<span class="string">&#x27;&#123;&#123; msg.tags &#125;&#125;&#x27;</span>);</span><br><span class="line"> &#123;% endfor %&#125;</span><br><span class="line"> &#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>新建提交订单的url和视图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 订单提交视图</span></span><br><span class="line">path(<span class="string">&#x27;order_pay/&#x27;</span>,views.order_pay,name=<span class="string">&#x27;order_pay&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">order_pay</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 提交订单 &quot;&quot;&quot;</span></span><br><span class="line">    user=request.user</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        sn = request.POST.get(<span class="string">&#x27;sn&#x27;</span>,<span class="literal">None</span>)</span><br><span class="line">        <span class="comment">#查询订单信息</span></span><br><span class="line">        order=user.orders.get(sn=sn)</span><br><span class="line">        <span class="comment"># 总额与积分比较，够了扣除，不够报错</span></span><br><span class="line">        <span class="keyword">if</span> order.buy_amount &gt; user.integral:</span><br><span class="line">            messages.error(request,<span class="string">&#x27;积分余额不足&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;mine:order&#x27;</span>,sn=sn)</span><br><span class="line">        user.update_integral(<span class="number">0</span>,order.buy_amount)</span><br><span class="line">        <span class="comment"># 修改订单状态</span></span><br><span class="line">        order.status=constants.ORDER_STATUS_PAID</span><br><span class="line">        order.save()</span><br><span class="line">        <span class="comment"># 修改购物车关联的状态</span></span><br><span class="line">        order.carts.<span class="built_in">all</span>().update(status=constants.ORDER_STATUS_PAID)</span><br><span class="line">        <span class="comment"># 支付成功消息提示</span></span><br><span class="line">        messages.success(request,<span class="string">&#x27;支付成功&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;mine:order&#x27;</span>,sn=sn)</span><br></pre></td></tr></table></figure>

<p>最后将订单页的表单提交到该url</p>
<h2 id="个人中心及订单列表"><a href="#个人中心及订单列表" class="headerlink" title="个人中心及订单列表"></a>个人中心及订单列表</h2><p>实现商品分类、个人中心模板等 尝试用类视图方式实现。</p>
<p>商品分类url：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 商品分类</span></span><br><span class="line">    path(<span class="string">&#x27;classify&#x27;</span>, views.ClassifyTemplateView.as_view(),name=<span class="string">&#x27;classify&#x27;</span>),</span><br></pre></td></tr></table></figure>

<p>views：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> ListView, TemplateView</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassifyTemplateView</span>(<span class="params">TemplateView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 商品分类页 &quot;&quot;&quot;</span></span><br><span class="line">    template_name = <span class="string">&#x27;classify.html&#x27;</span></span><br></pre></td></tr></table></figure>

<p>个人中心：</p>
<p>个人中心订单页面通过ListView展示，同时通过ajax异步添加订单内容，值得注意的是，订单列表加载内容被单独提取到了另一个order_load.html文件中，且需要在url中指定该模板<code>OrderListView.as_view(template_name=&#39;order_load.html&#39;)</code>，否则无法正常加载订单内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> re_path, path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mine <span class="keyword">import</span> views</span><br><span class="line"><span class="keyword">from</span> mine.views <span class="keyword">import</span> OrderDetailView, MineTemplateView, CollectView, OrderListView</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 个人中心</span></span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, views.login_required(MineTemplateView.as_view()), name=<span class="string">&#x27;mine&#x27;</span>),</span><br><span class="line">    <span class="comment"># 订单列表</span></span><br><span class="line">    path(<span class="string">&#x27;order_list/&#x27;</span>,login_required(OrderListView.as_view()),name=<span class="string">&#x27;order_list&#x27;</span>),</span><br><span class="line">    <span class="comment"># 订单列表加载</span></span><br><span class="line">    path(<span class="string">&#x27;order_load/&#x27;</span>,login_required(OrderListView.as_view(template_name=<span class="string">&#x27;order_load.html&#x27;</span>)),name=<span class="string">&#x27;order_load&#x27;</span>),</span><br><span class="line">    <span class="comment"># 收藏</span></span><br><span class="line">    path(<span class="string">&#x27;collect/&#x27;</span>,login_required(CollectView.as_view()),name=<span class="string">&#x27;collect&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Sum, Q</span><br><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> DetailView, TemplateView, ListView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> mine.models <span class="keyword">import</span> Order</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> constants</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MineTemplateView</span>(<span class="params">TemplateView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 个人中心详情 &quot;&quot;&quot;</span></span><br><span class="line">    template_name = <span class="string">&#x27;mine.html&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_context_data</span>(<span class="params">self, **kwargs</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;传入constants变量&quot;&quot;&quot;</span></span><br><span class="line">        context = <span class="built_in">super</span>().get_context_data(**kwargs)</span><br><span class="line">        context[<span class="string">&#x27;constants&#x27;</span>] = constants</span><br><span class="line">        <span class="keyword">return</span> context</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderListView</span>(<span class="params">ListView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 订单列表 &quot;&quot;&quot;</span></span><br><span class="line">    paginate_by = <span class="number">6</span></span><br><span class="line">    template_name = <span class="string">&#x27;all_orders.html&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; 添加订单状态进行搜索 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 先查询用户所有订单</span></span><br><span class="line">        order = Order.objects.<span class="built_in">filter</span>(user=self.request.user)</span><br><span class="line">        query = Q(status=constants.ORDER_STATUS_DELETED)</span><br><span class="line">        status = self.request.GET.get(<span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="comment"># 出入订单状态进行查询</span></span><br><span class="line">        <span class="keyword">if</span> status:</span><br><span class="line">            query = Q(status=status)</span><br><span class="line">            <span class="keyword">return</span> order.<span class="built_in">filter</span>(query)</span><br><span class="line">        <span class="comment"># 如果status传入为空（则查询全部有效订单），返回有效订单</span></span><br><span class="line">        <span class="keyword">return</span> order.exclude(query)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_context_data</span>(<span class="params">self, **kwargs</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; 添加传入模板的参数 &quot;&quot;&quot;</span></span><br><span class="line">        context = <span class="built_in">super</span>().get_context_data(**kwargs)</span><br><span class="line">        context[<span class="string">&#x27;constants&#x27;</span>] = constants</span><br><span class="line">        <span class="comment"># 转换status数据类型，方便在模板中进行比较判断</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            context[<span class="string">&#x27;status&#x27;</span>] = <span class="built_in">int</span>(self.request.GET.get(<span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            context[<span class="string">&#x27;status&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># 找出与订单绑定的购物车，从而找出商品信息传入模板</span></span><br><span class="line">        <span class="comment"># first()方法可以使得self.get_queryset()为空结果集时返回None</span></span><br><span class="line">        context[<span class="string">&#x27;cart_list&#x27;</span>] = Cart.objects.<span class="built_in">filter</span>(order=self.get_queryset().first())</span><br><span class="line">        <span class="keyword">return</span> context</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollectView</span>(<span class="params">TemplateView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 收藏页 &quot;&quot;&quot;</span></span><br><span class="line">    template_name = <span class="string">&#x27;shoucang.html&#x27;</span></span><br></pre></td></tr></table></figure>

<p>修改订单列表页的模板，通过判断订单状态，实现不同的显示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &#x27;base.html&#x27; %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>全部订单<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block container %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;wy-header wy-header-fixed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wy-header-icon-back&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wy-header-title&quot;</span>&gt;</span>订单管理<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-tab&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">class</span>=<span class="string">&quot;weui-navbar bar-fixed&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">style</span>=<span class="string">&quot;top:44px; height:44px; background:#fff;&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">class</span>=<span class="string">&quot;weui-navbar__item proinfo-tab-tit font-14</span></span></span><br><span class="line"><span class="string"><span class="tag">            &#123;% if status == &#x27;&#x27; %&#125;weui-bar__item--on&#123;% endif %&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;mine:order_list&#x27; %&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span>全部&lt;/a</span><br><span class="line">                &gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;weui-navbar__item proinfo-tab-tit font-14</span></span></span><br><span class="line"><span class="string"><span class="tag">            &#123;% if status == constants.ORDER_STATUS_SUBMIT %&#125;weui-bar__item--on&#123;% endif %&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;mine:order_list&#x27; %&#125;?status=&#123;&#123; constants.ORDER_STATUS_SUBMIT &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span>待付款&lt;/a</span><br><span class="line">                &gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;weui-navbar__item proinfo-tab-tit font-14</span></span></span><br><span class="line"><span class="string"><span class="tag">            &#123;% if status == constants.ORDER_STATUS_PAID %&#125;weui-bar__item--on&#123;% endif %&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;mine:order_list&#x27; %&#125;?status=&#123;&#123; constants.ORDER_STATUS_PAID &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span>待发货&lt;/a</span><br><span class="line">                &gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;weui-navbar__item proinfo-tab-tit font-14</span></span></span><br><span class="line"><span class="string"><span class="tag">            &#123;% if status == constants.ORDER_STATUS_SENT %&#125;weui-bar__item--on&#123;% endif %&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;mine:order_list&#x27; %&#125;?status=&#123;&#123; constants.ORDER_STATUS_SENT &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span>待收货&lt;/a</span><br><span class="line">                &gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;weui-navbar__item proinfo-tab-tit font-14</span></span></span><br><span class="line"><span class="string"><span class="tag">            &#123;% if status == constants.ORDER_STATUS_DONE %&#125;weui-bar__item--on&#123;% endif %&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;mine:order_list&#x27; %&#125;?status=&#123;&#123; constants.ORDER_STATUS_DONE &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                &gt;</span>待评价&lt;/a</span><br><span class="line">                &gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-tab__bd proinfo-tab-con&quot;</span> <span class="attr">id</span>=<span class="string">&#x27;order_list&#x27;</span> <span class="attr">style</span>=<span class="string">&quot;padding-top:87px;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block footer %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="handlebars"><span class="xml"></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        $(document).on(&#x27;click&#x27;, &#x27;.ords-btn-dele&#x27;, function () &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            $.confirm(</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                &#x27;您确定要删除此订单吗?&#x27;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                &#x27;确认删除?&#x27;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                function () &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    $.toast(&#x27;订单已经删除!&#x27;);</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                &#125;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                function () &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    //取消操作</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            );</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;);</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        $(document).on(&#x27;click&#x27;, &#x27;.receipt&#x27;, function () &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            $.alert(&#x27;五星好评送蓝豆哦，赶快去评价吧！&#x27;, &#x27;收货完成！&#x27;);</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;);</span></span></span><br><span class="line"><span class="xml"><span class="handlebars"></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        /* 封装函数，异步获取订单数据 */</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        var loading = false; //是否在加载中</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        var page = 1; //当前页</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        var noMore = false; //是否有下一页</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        function LoadData(callback) &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            if (loading) return;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            if (noMore) return;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            loading = true;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            $.ajax(&#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                url: &#x27;&#123;% url &#x27;mine:order_load&#x27; %&#125;&#x27;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                &#123;#async: false,#&#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                data: &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    page: page,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    cosntants: &#x27;</span><span class="template-variable">&#123;&#123; <span class="name">constants</span> &#125;&#125;</span><span class="xml">&#x27;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    status: &#x27;</span><span class="template-variable">&#123;&#123; <span class="name">status</span> &#125;&#125;</span><span class="xml">&#x27;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    cart_list: &#x27;</span><span class="template-variable">&#123;&#123; <span class="name">cart_list</span> &#125;&#125;</span><span class="xml">&#x27;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                &#125;,</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                // 调用接口成功后</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                success: function (rest) &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    // 添加html片段到内容区</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    $(&#x27;#order_list&#x27;).append(rest);</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    loading = false;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    // 如果有回调函数则调用</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    if (callback) &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                        callback()</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                    &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            &#125;)</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars"></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        $(document.body).infinite(200).on(&#x27;infinite&#x27;, function () &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            if (page &lt;</span><span class="template-variable">&#123;&#123; <span class="name">paginator.num_pages</span> &#125;&#125;</span><span class="xml">) &#123;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                page++;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">                LoadData();</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">            &#125;</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        &#125;);</span></span></span><br><span class="line"><span class="xml"><span class="handlebars"></span></span></span><br><span class="line"><span class="xml"><span class="handlebars">        LoadData();</span></span></span><br><span class="line"><span class="xml"><span class="handlebars">    </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>order_load.html:</p>
<p><code>order.get_status_display</code>可以获取status对应文字内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;tab1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-tab__bd-item weui-tab__bd-item--active&quot;</span>&gt;</span></span><br><span class="line">              &#123;% for order in object_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-panel weui-panel_access&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-panel__hd&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>单号：&#123;&#123; order.sn &#125;&#125;&lt;/span</span><br><span class="line">                &gt;<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;ord-status-txt-ts fr&quot;</span>&gt;</span></span><br><span class="line">                  &#123;% if status == &#x27;&#x27; %&#125;&#123;&#123; order.get_status_display &#125;&#125;&#123;% endif %&#125;</span><br><span class="line">                  &#123;% if status == constants.ORDER_STATUS_SUBMIT %&#125;待付款&#123;% endif %&#125;</span><br><span class="line">                  &#123;% if status == constants.ORDER_STATUS_PAID %&#125;待发货&#123;% endif %&#125;</span><br><span class="line">                  &#123;% if status == constants.ORDER_STATUS_SENT %&#125;待收货&#123;% endif %&#125;</span><br><span class="line">                  &#123;% if status == constants.ORDER_STATUS_DONE %&#125;待评价&#123;% endif %&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__bd  pd-10&quot;</span>&gt;</span></span><br><span class="line">              &#123;% for cart in order.carts.all %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box_appmsg ord-pro-list&quot;</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__hd&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;mall:pro_info&#x27; cart.product.uid %&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                      &gt;</span><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">class</span>=<span class="string">&quot;weui-media-box__thumb&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; cart.img.url &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">                    /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__bd&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__desc&quot;</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;mall:pro_info&#x27; cart.product.uid %&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ord-pro-link&quot;</span></span></span><br><span class="line"><span class="tag">                        &gt;</span>&#123;&#123; cart.name &#125;&#125;&lt;/a</span><br><span class="line">                      &gt;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;weui-media-box__desc&quot;</span>&gt;</span></span><br><span class="line">                      规格：<span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>，<span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;clear mg-t-10&quot;</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wy-pro-pri fl&quot;</span>&gt;</span></span><br><span class="line">                        ¥<span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;num font-15&quot;</span>&gt;</span>&#123;&#123; cart.price &#125;&#125;<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pro-amount fr&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;font-13&quot;</span></span></span><br><span class="line"><span class="tag">                          &gt;</span>数量×<span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>&#123;&#123; cart.count &#125;&#125;<span class="tag">&lt;/<span class="name">em</span>&gt;</span>&lt;/span</span><br><span class="line">                        &gt;</span><br><span class="line">                      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              &#123;% endfor %&#125;</span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;ord-statistics&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>共<span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;num&quot;</span>&gt;</span>&#123;&#123; order.carts.all.count &#125;&#125;<span class="tag">&lt;/<span class="name">em</span>&gt;</span>件商品，<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;wy-pro-pri&quot;</span></span></span><br><span class="line"><span class="tag">                  &gt;</span>总金额：¥<span class="tag">&lt;<span class="name">em</span> <span class="attr">class</span>=<span class="string">&quot;num font-15&quot;</span>&gt;</span>&#123;&#123; order.buy_amount &#125;&#125;<span class="tag">&lt;/<span class="name">em</span>&gt;</span>&lt;/span</span><br><span class="line">                &gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>(含运费<span class="tag">&lt;<span class="name">b</span>&gt;</span>￥0.00<span class="tag">&lt;/<span class="name">b</span>&gt;</span>)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-panel__ft&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-cell weui-cell_access weui-cell_link oder-opt-btnbox&quot;</span>&gt;</span></span><br><span class="line">                    &#123;% if status == constants.ORDER_STATUS_SUBMIT or status == constants.ORDER_STATUS_DONE %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ords-btn-dele&quot;</span>&gt;</span>删除订单<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    &#123;% endif %&#125;</span><br><span class="line">                    &#123;% if status == constants.ORDER_STATUS_SUBMIT %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;order_info2.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ords-btn-com&quot;</span>&gt;</span>去付款<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    &#123;% endif %&#125;</span><br><span class="line">                    &#123;% if status == constants.ORDER_STATUS_SENT %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ords-btn-com receipt&quot;</span>&gt;</span>确认收货<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    &#123;% endif %&#125;</span><br><span class="line">                    &#123;% if status == constants.ORDER_STATUS_DONE %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;comment.html&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ords-btn-com&quot;</span>&gt;</span>评价<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    &#123;% endif %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              &#123;% endfor %&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>给页脚模板添加首页、个人中心、分类、购物车等等跳转，同时相应页面的页脚添加css效果。</p>
<p>引入页脚模板时候加入tab标签，这样页脚就能根据标签显示对应css效果（css特效通过的是jQuery模板class中的weui-bar__item–on显示）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 个人中心模块 --&gt;</span></span><br><span class="line">&#123;% include &#x27;footer.html&#x27; with tab=&#x27;mine&#x27; %&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- footer.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;mine:mine&#x27; %&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-tabbar__item</span></span></span><br><span class="line"><span class="string"><span class="tag">                                       &#123;% if tab == &#x27;mine&#x27;%&#125;weui-bar__item--on&#123;% endif %&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;weui-tabbar__icon foot-menu-member&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;weui-tabbar__label&quot;</span>&gt;</span>我的<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在base.html中添加全局的返回事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;.wy-header-icon-back&#x27;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	history.go(-<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>个人中心模板中，实现各个类型订单按钮的跳转，通过添加status参数的方式，视图中通过判断status参数调取订单数据。而订单列表模板中（如上）则通过判断status参数显示不同的内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;mine:order_list&#x27; %&#125;?status=&#123;&#123; constants.ORDER_STATUS_SUBMIT &#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;center-ordersModule&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="admin账户的内容编辑"><a href="#admin账户的内容编辑" class="headerlink" title="admin账户的内容编辑"></a>admin账户的内容编辑</h3><p>在admin后台管理中，默认的用户信息编辑中，只显示了三块内容，无法进行其他的用户信息的添加与编辑。</p>
<p><img src="/2020/07/02/django-mall3/image-20200723160132708.png" alt="image-20200723160132708"></p>
<p>如果要通过后台进行其他用户信息的修改，查看UserAdmin源码后，发现可以通过fieldsets来进行修改。</p>
<p><img src="/2020/07/02/django-mall3/image-20200723160714972.png" alt="image-20200723160714972"></p>
<p>比如我们要添加用户积分integral的显示修改，则复制该父类的fieldsets源码到用户admin类中，添加该字段即可。简单粗暴地进行改写</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@admin.register(<span class="params">User</span>)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserAdmin</span>(<span class="params">UserAdmin</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 用户管理 &quot;&quot;&quot;</span></span><br><span class="line">    list_display = (<span class="string">&#x27;format_username&#x27;</span>,<span class="string">&#x27;nickname&#x27;</span>,<span class="string">&#x27;integral&#x27;</span>,<span class="string">&#x27;is_valid&#x27;</span>)</span><br><span class="line">    fieldsets = (</span><br><span class="line">        (<span class="literal">None</span>, &#123;<span class="string">&#x27;fields&#x27;</span>: (<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>)&#125;),</span><br><span class="line">        ((<span class="string">&#x27;Personal info&#x27;</span>), &#123;<span class="string">&#x27;fields&#x27;</span>: (<span class="string">&#x27;first_name&#x27;</span>, <span class="string">&#x27;last_name&#x27;</span>, <span class="string">&#x27;email&#x27;</span>,<span class="string">&#x27;integral&#x27;</span>)&#125;),</span><br><span class="line">        ((<span class="string">&#x27;Permissions&#x27;</span>), &#123;</span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>: (<span class="string">&#x27;is_active&#x27;</span>, <span class="string">&#x27;is_staff&#x27;</span>, <span class="string">&#x27;is_superuser&#x27;</span>, <span class="string">&#x27;groups&#x27;</span>, <span class="string">&#x27;user_permissions&#x27;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">        ((<span class="string">&#x27;Important dates&#x27;</span>), &#123;<span class="string">&#x27;fields&#x27;</span>: (<span class="string">&#x27;last_login&#x27;</span>, <span class="string">&#x27;date_joined&#x27;</span>)&#125;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">format_username</span>(<span class="params">self,obj</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; 用户名脱敏处理 &quot;&quot;&quot;</span></span><br><span class="line">        format_username = obj.username[<span class="number">0</span>:<span class="number">3</span>] + <span class="string">&#x27;***&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> format_username</span><br><span class="line"></span><br><span class="line">    format_username.short_description = <span class="string">&#x27;用户名&#x27;</span></span><br><span class="line">    search_list = (<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;nickname&#x27;</span>)</span><br><span class="line">    actions = [set_valid,set_invalid]</span><br></pre></td></tr></table></figure>

<h3 id="订单提交的bug"><a href="#订单提交的bug" class="headerlink" title="订单提交的bug"></a>订单提交的bug</h3><p>订单提交之后，依然在原始页面，然后点击该页面的支付按钮后会报错无该订单。</p>
<p>解决办法1：给button添加a标签实现跳转</p>
<p>解决方法2：因为支付后 订单属性发生变化，判断订单属性显示不同内容。</p>
<p>订单详细传入constants参数到模板。</p>
<p>在订单的DetailView中传入constants变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderDetailView</span>(<span class="params">DetailView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 订单详情 &quot;&quot;&quot;</span></span><br><span class="line">    model = Order</span><br><span class="line">    <span class="comment"># 将模型中的sn字段传入url参数进行查询</span></span><br><span class="line">    slug_field = <span class="string">&#x27;sn&#x27;</span></span><br><span class="line">    slug_url_kwarg = <span class="string">&#x27;sn&#x27;</span></span><br><span class="line">    template_name = <span class="string">&#x27;order_info2.html&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_context_data</span>(<span class="params">self, **kwargs</span>):</span></span><br><span class="line">        context = <span class="built_in">super</span>().get_context_data(**kwargs)</span><br><span class="line">        context[<span class="string">&#x27;constants&#x27;</span>] = constants</span><br><span class="line">        <span class="keyword">return</span> context</span><br></pre></td></tr></table></figure>

<p>在html页面中进行判断</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if object.status != constants.ORDER_STATUS_PAID %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mg10-0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weui-btn weui-btn_primary&quot;</span>&gt;</span>积分支付<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="待解决问题"><a href="#待解决问题" class="headerlink" title="待解决问题"></a>待解决问题</h2><p>订单的多次提交</p>
<p>商城收藏页的完善</p>
<p>商品分类页的完善</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">一只柑</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://123.57.158.5/2020/07/02/django-mall3/">http://123.57.158.5/2020/07/02/django-mall3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://123.57.158.5" target="_blank">一只柑の博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Django/">Django</a><a class="post-meta__tags" href="/tags/%E5%AE%9E%E6%88%98/">实战</a><a class="post-meta__tags" href="/tags/JavaScript/">JavaScript</a><a class="post-meta__tags" href="/tags/JQuery/">JQuery</a><a class="post-meta__tags" href="/tags/AJAX/">AJAX</a></div><div class="post_share"><div class="social-share" data-image="http://cdn.rice-and-bran.site/Django_cover1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/" target="_blank"><img class="post-qr-code-img" src="/"/></a><div class="post-qr-code-desc"></div></li><li class="reward-item"><a href="/" target="_blank"><img class="post-qr-code-img" src="/"/></a><div class="post-qr-code-desc"></div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/07/16/django-error/"><img class="prev-cover" src="http://cdn.rice-and-bran.site/Django_cover1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Django使用的部分报错</div></div></a></div><div class="next-post pull-right"><a href="/2020/07/01/python-shared-memory/"><img class="next-cover" src="http://cdn.rice-and-bran.site/python.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Python进程同步之共享内存</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/06/10/django-mooc-project2/" title="Django2.2实战积分商城2——表单的使用"><img class="cover" src="http://cdn.rice-and-bran.site/Django_cover1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-10</div><div class="title">Django2.2实战积分商城2——表单的使用</div></div></a></div><div><a href="/2020/04/09/Django框架入门/" title="Django框架入门"><img class="cover" src="http://cdn.rice-and-bran.site/Django_cover1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-09</div><div class="title">Django框架入门</div></div></a></div><div><a href="/2020/05/12/django-mooc-project/" title="Django2.2实战积分商城1——创建ORM模型"><img class="cover" src="http://cdn.rice-and-bran.site/Django_cover1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-12</div><div class="title">Django2.2实战积分商城1——创建ORM模型</div></div></a></div><div><a href="/2020/07/29/Django安全及维护/" title="Django安全及维护————以积分商城为例"><img class="cover" src="http://cdn.rice-and-bran.site/Django_cover1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-29</div><div class="title">Django安全及维护————以积分商城为例</div></div></a></div><div><a href="/2020/04/22/Django对象关系映射-ORM/" title="Django对象关系映射(ORM)"><img class="cover" src="http://cdn.rice-and-bran.site/Django_cover1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-22</div><div class="title">Django对象关系映射(ORM)</div></div></a></div><div><a href="/2020/06/28/django-admin/" title="Django后台管理系统——以积分商城为例"><img class="cover" src="http://cdn.rice-and-bran.site/Django_cover1.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-28</div><div class="title">Django后台管理系统——以积分商城为例</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">一只柑</div><div class="author-info__description">心中有海 不赶浪潮</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">77</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">63</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div></div><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:jwei.gan@qq.com" target="_blank" title="Email"><i class="fa fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E7%94%A8%E6%88%B7%E7%AD%89%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE"><span class="toc-number">1.</span> <span class="toc-text">商品用户等管理配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E5%AF%8C%E6%96%87%E6%9C%AC%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">商品富文本的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E5%89%8D%E5%8F%B0%E5%B1%95%E7%A4%BA"><span class="toc-number">3.</span> <span class="toc-text">商品前台展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E6%A0%87%E7%AD%BE"><span class="toc-number">4.</span> <span class="toc-text">商品标签</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E5%93%81%E8%AF%A6%E6%83%85%E5%8F%8A%E8%B4%AD%E4%B9%B0"><span class="toc-number">5.</span> <span class="toc-text">商品详情及购买</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5%E9%9D%A2"><span class="toc-number">6.</span> <span class="toc-text">订单详情页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%B0%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-number">7.</span> <span class="toc-text">添加到购物车</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E8%AE%A2%E5%8D%95"><span class="toc-number">8.</span> <span class="toc-text">提交订单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E6%94%AF%E4%BB%98"><span class="toc-number">9.</span> <span class="toc-text">订单支付</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83%E5%8F%8A%E8%AE%A2%E5%8D%95%E5%88%97%E8%A1%A8"><span class="toc-number">10.</span> <span class="toc-text">个人中心及订单列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">11.</span> <span class="toc-text">补充</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#admin%E8%B4%A6%E6%88%B7%E7%9A%84%E5%86%85%E5%AE%B9%E7%BC%96%E8%BE%91"><span class="toc-number">11.1.</span> <span class="toc-text">admin账户的内容编辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E6%8F%90%E4%BA%A4%E7%9A%84bug"><span class="toc-number">11.2.</span> <span class="toc-text">订单提交的bug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%85%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98"><span class="toc-number">12.</span> <span class="toc-text">待解决问题</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/02/06/java-io/" title="JavaIO操作笔记"><img src="/img/psb.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaIO操作笔记"/></a><div class="content"><a class="title" href="/2022/02/06/java-io/" title="JavaIO操作笔记">JavaIO操作笔记</a><time datetime="2022-02-06T05:58:15.000Z" title="发表于 2022-02-06 13:58:15">2022-02-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/29/kmp-next-list/" title="KMP算法之next数组代码理解"><img src="/img/psb.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="KMP算法之next数组代码理解"/></a><div class="content"><a class="title" href="/2021/12/29/kmp-next-list/" title="KMP算法之next数组代码理解">KMP算法之next数组代码理解</a><time datetime="2021-12-29T14:49:53.000Z" title="发表于 2021-12-29 22:49:53">2021-12-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/26/java-thread/" title="java基础知识补充"><img src="http://cdn.rice-and-bran.site/java_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java基础知识补充"/></a><div class="content"><a class="title" href="/2021/12/26/java-thread/" title="java基础知识补充">java基础知识补充</a><time datetime="2021-12-26T15:26:12.000Z" title="发表于 2021-12-26 23:26:12">2021-12-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/21/java-thread-pool/" title="Java线程池解析"><img src="http://cdn.rice-and-bran.site/java_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java线程池解析"/></a><div class="content"><a class="title" href="/2021/12/21/java-thread-pool/" title="Java线程池解析">Java线程池解析</a><time datetime="2021-12-21T14:08:54.000Z" title="发表于 2021-12-21 22:08:54">2021-12-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/13/java-power2/" title="Java判定2的方幂和2方幂取法"><img src="/img/psb.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java判定2的方幂和2方幂取法"/></a><div class="content"><a class="title" href="/2021/12/13/java-power2/" title="Java判定2的方幂和2方幂取法">Java判定2的方幂和2方幂取法</a><time datetime="2021-12-13T14:02:18.000Z" title="发表于 2021-12-13 22:02:18">2021-12-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 一只柑</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">赣ICP备20002874号</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script></div></div></body></html>